# 작업일지 - 2025-12-11

## 작업 시간
- 시작: 20:00
- 종료: 21:15
- 총 작업 시간: 약 1시간 15분 

## 완료한 작업
- [x] .gitignore 파일에 OS (Windows/macOS) 관련 항목 추가
- [x] .gitignore 파일에 FastAPI 관련 항목 추가
- [x] Git 커밋 메시지 형식 정립 (`251211 > back-end > fast-api > 작업내용`)
- [x] Git 한글 인코딩 문제 해결 (파일을 통한 커밋 메시지 전달 방식 적용)
- [x] 프로젝트 문서화 계획 수립
- [x] 작업일지 시스템 구축 (날짜별 폴더 구조)
- [x] 프로젝트 기획서 파악 및 문서화
  - [x] `docs/PROJECT_OVERVIEW.md` 생성 (프로젝트 개요 및 핵심 개념)
  - [x] `docs/DEVELOPMENT_PLAN.md` 생성 (6주 개발 계획서)
- [x] FastAPI 프로젝트 기본 구조 생성
  - [x] 폴더 구조 생성 (app/, tests/, docs/)
  - [x] 기본 모듈 파일 생성 (__init__.py)
  - [x] `app/main.py` 생성 (FastAPI 앱 진입점, CORS 설정)
  - [x] `app/config.py` 생성 (Pydantic 기반 설정 관리)
  - [x] `app/utils/constants.py` 생성 (게임 상수 정의: 역할, 카드 타입, 액션 타입 등)
  - [x] `requirements.txt` 생성 (필수 패키지 목록)
- [x] 문서 구조 재구성 및 상세 문서 작성
  - [x] `docs/README.md` 생성 (문서 가이드)
  - [x] `docs/architecture/system-design.md` 생성 (시스템 아키텍처, 의사결정, 트러블슈팅, 성능 고려사항 포함)
  - [x] `docs/fastapi/features/project-structure.md` 생성 (프로젝트 구조 설계, 코드 예시, 의사결정 기록 포함)
  - [x] `docs/fastapi/best-practices.md` 생성 (FastAPI 베스트 프랙티스 적용)
- [x] Git 커밋 완료 (커밋 해시: 46a57f8)
  - [x] 프로젝트 기본 구조 및 문서화 커밋
  - [x] 총 20개 파일, 1173줄 추가
- [x] 기본 모델 클래스 구현 완료
  - [x] `app/models/role.py` - Role 모델 (역할 관리)
  - [x] `app/models/card.py` - Card 모델 (카드 속성 및 기능)
  - [x] `app/models/player.py` - Player 모델 (플레이어 상태 관리)
  - [x] `app/models/game.py` - Game 모델 (게임 전체 상태 관리)
  - [x] `docs/fastapi/features/models.md` - 모델 구현 문서 작성
- [x] 문서 정리 및 인덱스 추가
  - [x] `docs/README.md` 업데이트 (실제 생성된 문서 구조 반영)
  - [x] `docs/INDEX.md` 생성 (문서 빠른 탐색용 인덱스)
- [x] Git 커밋 및 푸시 완료 (커밋 해시: 5a3ae7b)
  - [x] 기본 모델 클래스 구현 및 문서 정리 커밋
  - [x] 총 9개 파일 변경, 869줄 추가
- [x] 카드 덱 생성 로직 구현 완료
  - [x] `app/utils/constants.py` - 카드 덱 구성 및 상세 정보 정의 (총 80장)
  - [x] `app/game/card_manager.py` - CardManager 클래스 구현
    - [x] 덱 생성 로직
    - [x] 카드 셔플 로직
    - [x] 카드 드로우/버리기 로직
    - [x] 덱 재생성 로직 (버림 더미 → 덱)
  - [x] `docs/fastapi/features/card-manager.md` - 카드 관리자 문서화
- [x] Git 커밋 및 푸시 완료 (커밋 해시: 40f1442)
  - [x] 카드 덱 생성 로직 구현 커밋
  - [x] 총 6개 파일 변경, 526줄 추가
- [x] 게임 매니저 기본 구조 구현 완료
  - [x] `app/game/game_manager.py` - GameManager 클래스 구현
    - [x] 게임 생성 및 관리
    - [x] 플레이어 추가 및 역할 배정
    - [x] 게임 시작 로직 (카드 덱 생성, 초기 카드 분배)
    - [x] 게임 상태 관리
    - [x] 승리 조건 체크 (상단주 팀, 적도 세력, 야망가)
    - [x] CardManager 통합
  - [x] `docs/fastapi/features/game-manager.md` - 게임 매니저 문서화
- [x] 문서 정리 (README.md, INDEX.md 업데이트)
- [x] Git 커밋 및 푸시 완료 (커밋 해시: 73c5476)
  - [x] 게임 매니저 구현 및 문서 정리 커밋
  - [x] 총 7개 파일 변경, 633줄 추가
- [x] 턴 관리자 구현 완료
  - [x] `app/game/turn_manager.py` - TurnManager 클래스 구현
    - [x] 턴 순서 관리 (다음 플레이어 찾기)
    - [x] 턴 단계 관리 (DRAW → PLAY_CARD → RESPOND → END_TURN)
    - [x] 카드 드로우 단계 처리 (기본 2장, 덱 재생성 자동 처리)
    - [x] 턴 종료 처리 및 다음 플레이어로 이동
    - [x] GameManager 및 CardManager 통합
  - [x] `docs/fastapi/features/turn-manager.md` - 턴 관리자 문서화
- [x] 문서 정리 (README.md, INDEX.md 업데이트)
- [x] Git 커밋 및 푸시 완료 (커밋 해시: 4acdc2b)
  - [x] 턴 관리자 구현 및 문서 정리 커밋
  - [x] 총 7개 파일 변경, 538줄 추가
- [x] 액션 핸들러 구현 완료
  - [x] `app/game/action_handler.py` - ActionHandler 클래스 구현
    - [x] 액션 처리 기본 구조 (handle_action)
    - [x] 액션 유효성 검증 (validate_action)
    - [x] 카드 사용 로직 (정산, 회피, 비상금)
    - [x] 공격/방어 메커니즘 (거리 검증, 대응 처리)
    - [x] 턴 종료 처리
    - [x] GameManager, TurnManager, CardManager 통합
  - [x] `docs/fastapi/features/action-handler.md` - 액션 핸들러 문서화
- [x] 문서 정리 (README.md, INDEX.md 업데이트)
- [x] Git 커밋 및 푸시 완료 (커밋 해시: 576d0af)
  - [x] 액션 핸들러 구현 및 문서 정리 커밋
  - [x] 총 7개 파일 변경, 776줄 추가
- [x] WebSocket 기본 연결 구현 완료
  - [x] `app/websocket/connection_manager.py` - ConnectionManager 클래스 구현
    - [x] WebSocket 연결 관리
    - [x] 플레이어-연결 매핑
    - [x] 게임별 플레이어 그룹핑
    - [x] 개별 메시지 전송 및 브로드캐스트
  - [x] `app/websocket/message_handler.py` - MessageHandler 클래스 구현
    - [x] 메시지 처리 (PLAYER_ACTION, JOIN_GAME, GET_GAME_STATE)
    - [x] 게임 상태 동기화 (자동 브로드캐스트)
    - [x] GameManager, ActionHandler 통합
  - [x] `app/main.py` - WebSocket 엔드포인트 추가 (`/ws/{player_id}`)
  - [x] `docs/fastapi/features/websocket.md` - WebSocket 구현 문서화

## 진행 중인 작업
- [ ] 프론트엔드와 WebSocket 연결 테스트
- [ ] 로비 엔드포인트 구현 (`/lobby/{game_id}`)

## 오늘 추가 완료한 작업 (이후 시간)
- [x] 프론트엔드 연동 작업 계획 수립
  - [x] `docs/FRONTEND_COORDINATION_PLAN.md` 생성 (프론트엔드 공조 메일 분석 및 작업 계획)
  - [x] 메시지 프로토콜 차이점 분석 및 수정 계획 수립
- [x] 메시지 프로토콜 수정 완료
  - [x] `PLAYER_ACTION` 메시지 형식 변경 (action_type → action.type 구조)
  - [x] `GAME_STATE_UPDATE` 메시지 형식 변경 (프론트엔드 요청 형식)
  - [x] 플레이어 정보 구조 변경 (role, hp, influence, hand, tableCards, treasures)
  - [x] 게임 상태에 turnState, events, phase 필드 추가
  - [x] `app/websocket/message_handler.py` 수정
  - [x] `app/models/game.py` 수정 (이벤트 로그 시스템 추가)
  - [x] `app/models/player.py` 수정 (프론트엔드 요청 형식으로 변환)
  - [x] `app/game/action_handler.py` 수정 (이벤트 타입 명시)
  - [x] `app/game/turn_manager.py` 수정 (이벤트 타입 명시)
- [x] NAS 서버 구축 가이드 작성
  - [x] `docs/NAS_SERVER_SETUP_GUIDE.md` 생성 (서버 환경 구축 전용 가이드)
  - [x] 도메인 설정 가이드 추가 (ledger-weight-api.livbee.co.kr)
  - [x] Nginx 리버스 프록시 설정 가이드
  - [x] SSL 인증서 설정 가이드 (Let's Encrypt)
  - [x] GitHub Actions CI/CD 자동배포 설정 가이드
  - [x] 프로젝트 명명 규칙 정립 (ledger-weight-*)
- [x] 데이터베이스 추천 가이드 작성
  - [x] `docs/DATABASE_RECOMMENDATION.md` 생성 (Redis 추천)
- [x] 배포 준비 작업
  - [x] `docs/DEPLOYMENT_CHECKLIST_RESPONSE.md` 생성 (서버 담당자 회신 메일 답변)
  - [x] `env.example` 파일 생성 (환경 변수 템플릿)
  - [x] `README.md` 업데이트 (프로젝트 개요 및 빠른 시작 가이드)
  - [x] `docs/PRE_DEPLOYMENT_TASKS.md` 생성 (배포 전 작업 체크리스트)
- [x] GitHub Actions 워크플로우 파일 생성
  - [x] `.github/workflows/deploy-ledger-weight.yml` 생성 (CI/CD 자동배포)

## 이슈 및 해결
### 이슈: Git 커밋 메시지 한글 깨짐
- **문제**: PowerShell에서 직접 한글 커밋 메시지를 전달할 때 인코딩 문제 발생
- **해결**: 임시 파일(`commit_msg.txt`)을 생성하여 커밋 메시지를 전달하는 방식으로 해결
- **향후**: 한글이 포함된 커밋 메시지는 파일을 통해 전달하는 방식 유지

### 이슈: 문서화 누락 항목 확인 및 보완
- **문제**: 코드 예시, 의사결정 기록, 트러블슈팅, 성능 고려사항이 문서에 누락됨
- **해결**: 문서 구조 재구성 및 상세 문서 작성
  - `docs/architecture/system-design.md`: 시스템 아키텍처 설계 문서 작성
  - `docs/fastapi/features/project-structure.md`: 프로젝트 구조 설계 문서 작성
  - `docs/fastapi/best-practices.md`: FastAPI 베스트 프랙티스 문서 작성
- **결과**: 모든 문서에 코드 예시, 의사결정 기록, 트러블슈팅, 성능 고려사항 포함 완료

## 학습 및 참고 자료
- FastAPI 공식 문서
- Git 인코딩 설정 (UTF-8)
- BANG! 카드 게임 메커니즘 (원작)
- WebSocket 실시간 통신 패턴

## 다음 작업 계획
- [ ] 로비 엔드포인트 구현 (`/lobby/{game_id}`)
- [ ] 프론트엔드와 WebSocket 연결 테스트
- [ ] GitHub 레포지토리 URL 확인 및 업데이트
- [ ] NAS 서버 배포 테스트

## 추가 작업 (서버 담당자 요청)
- [x] GitHub Actions 워크플로우 파일 업데이트
  - [x] Python 버전 3.10 → 3.12로 변경
  - [x] 프로젝트 경로 `/opt/ledger-weight/` → `/home/iwh/ledger-weight/`로 변경
  - [x] 서버 담당자 요청사항 반영 완료

## 메모
- 포트폴리오 프로젝트로 진행
- 각 FastAPI 기능 구현 시 문서화 필수
- DB 설계 및 관계도 문서화 예정
- 원작 BANG! 메커니즘 100% 계승, 테마만 변경
- WebSocket 기반 실시간 카드 게임
- 16종 보물, 다양한 카드 타입, 4가지 역할 구현 필요

