# 향후 작업 계획

**작성일**: 2025-12-12  
**최종 업데이트**: 2025-12-12  
**상태**: 진행 중

---

## 📋 현재 상태

### ✅ 완료된 작업
- [x] 기본 게임 로직 구현 완료
- [x] WebSocket 기본 연결 구현 완료
- [x] 메시지 프로토콜 수정 완료 (프론트엔드 요청 형식)
- [x] NAS 서버 구축 가이드 작성 완료
- [x] GitHub Actions CI/CD 자동배포 설정 완료
- [x] Tailscale VPN 연동 완료
- [x] ImportError 수정 완료

### ✅ 배포 상태
- **서비스 상태**: `active (running)`
- **포트**: `8088`
- **Health Check**: 정상 작동
- **접속 URL**: `https://ledger-weight-api.livbee.co.kr`
- **자동 배포**: GitHub Actions를 통한 자동 배포 정상 작동

---

## 🎯 우선순위별 향후 작업 계획

### Phase 1: 프론트엔드 연동 준비 (우선순위: 높음)

#### 1.1 로비 엔드포인트 구현
- [x] `/lobby/{game_id}` WebSocket 엔드포인트 구현 (2025-12-12 완료)
- [x] 쿼리 파라미터로 `player` 이름 받기
- [x] 플레이어 ID 자동 생성 (UUID)
- [x] 연결 성공 시 자동 게임 참가 처리
- [x] `GAME_STATE_UPDATE` 메시지 자동 전송

**예상 소요 시간**: 30분  
**파일**: `app/main.py`, `app/websocket/message_handler.py`

#### 1.2 게임 시작 프로토콜
- [ ] `START_GAME` 메시지 타입 처리
- [ ] 최소 플레이어 수 확인
- [ ] 게임 시작 시 모든 플레이어에게 상태 전송

**예상 소요 시간**: 20분  
**파일**: `app/websocket/message_handler.py`

#### 1.3 프론트엔드와 연동 테스트
- [ ] 기본 WebSocket 연결 테스트
- [ ] 메시지 송수신 테스트
- [ ] 게임 플로우 전체 테스트
- [ ] 에러 처리 테스트

**예상 소요 시간**: 1-2시간

---

### Phase 2: 기능 개선 (우선순위: 중간)

#### 2.1 턴 타이머 구현
- [ ] 서버 측 타이머 관리 로직 구현
- [ ] 주기적으로 `timeLeft` 업데이트 전송
- [ ] 시간 초과 시 자동 턴 종료

**예상 소요 시간**: 1시간  
**파일**: `app/game/turn_manager.py`, `app/models/game.py`

#### 2.2 공격 대상 추적 개선
- [ ] `Game` 모델에 `defending_player_id` 필드 추가
- [ ] `requiredResponse` 정확한 설정
- [ ] 공격/방어 플로우 개선

**예상 소요 시간**: 30분  
**파일**: `app/models/game.py`, `app/game/action_handler.py`

#### 2.3 에러 코드 체계 구축
- [ ] 에러 코드 정의 (`app/utils/error_codes.py`)
- [ ] 에러 코드 목록 문서화
- [ ] `ERROR` 메시지에 `code` 필드 포함

**예상 소요 시간**: 30분  
**파일**: `app/utils/error_codes.py`, `app/websocket/message_handler.py`

---

### Phase 3: 데이터베이스 도입 (우선순위: 중간)

#### 3.1 Redis 도입
- [ ] Redis 클라이언트 구현
- [ ] GameManager에 Redis 통합
- [ ] 게임 상태 Redis 저장/조회
- [ ] 세션 관리 (TTL 설정)

**예상 소요 시간**: 2-3시간  
**파일**: `app/database/redis_client.py`, `app/game/game_manager.py`

#### 3.2 영구 저장 (선택사항)
- [ ] PostgreSQL 설정
- [ ] 게임 통계 스키마 설계
- [ ] 게임 종료 시 통계 저장
- [ ] 통계 조회 API 구현

**예상 소요 시간**: 3-4시간

---

### Phase 4: 추가 카드 및 기능 구현 (우선순위: 낮음)

#### 4.1 미구현 카드 타입 구현
- [ ] 전원 견제 (GATLING)
- [ ] 패거리 습격 (INDIANS)
- [ ] 승부 (DUEL)
- [ ] 강제 압류 (PANIC)
- [ ] 공개 연회 (SALOON)
- [ ] 자선 경매 (GENERAL_STORE)

**예상 소요 시간**: 각 카드당 30분-1시간

#### 4.2 장착 카드 구현
- [ ] 무기 카드 (연속 상환 요구, 독점 상권 선언)
- [ ] 장착 카드 (첩보원, 신의 한 수, 세력권 경계, 영업 금지)

**예상 소요 시간**: 각 카드당 30분-1시간

#### 4.3 보물 시스템 구현
- [ ] 16종 보물 구현
- [ ] 보물 효과 로직 구현

**예상 소요 시간**: 보물당 1-2시간

---

### Phase 5: 최적화 및 안정화 (우선순위: 낮음)

#### 5.1 성능 최적화
- [ ] 게임 상태 캐싱
- [ ] 메시지 브로드캐스트 최적화
- [ ] 메모리 사용량 모니터링

**예상 소요 시간**: 2-3시간

#### 5.2 에러 처리 강화
- [ ] 네트워크 오류 처리
- [ ] 재연결 로직 개선
- [ ] 게임 상태 복구 로직

**예상 소요 시간**: 2-3시간

#### 5.3 로깅 시스템
- [ ] 구조화된 로깅 구현
- [ ] 로그 레벨 관리
- [ ] 에러 로그 수집 및 분석

**예상 소요 시간**: 1-2시간

---

## 📅 단기 작업 계획 (1-2주)

### 1주차
- [ ] 로비 엔드포인트 구현
- [ ] 게임 시작 프로토콜 구현
- [ ] 프론트엔드와 기본 연동 테스트
- [ ] 턴 타이머 구현

### 2주차
- [ ] 공격 대상 추적 개선
- [ ] 에러 코드 체계 구축
- [ ] Redis 도입 (선택사항)
- [ ] 추가 카드 타입 구현 (2-3개)

---

## 🔍 즉시 진행 가능한 작업

### 우선순위 1: 로비 엔드포인트 구현
프론트엔드 연동을 위해 가장 시급한 작업입니다.

### 우선순위 2: 게임 시작 프로토콜
로비에서 게임을 시작할 수 있는 기능이 필요합니다.

### 우선순위 3: 프론트엔드 연동 테스트
실제 프론트엔드와 연동하여 전체 플로우를 테스트합니다.

---

## 📝 참고사항

### 현재 서버 상태
- ✅ 서비스 정상 작동 중
- ✅ 자동 배포 정상 작동
- ✅ Health Check 정상
- ✅ Tailscale VPN 연결 완료

### 프론트엔드 요청사항
- 로비 엔드포인트 (`/lobby/{game_id}`) 필요
- 게임 시작 프로토콜 필요
- AI 플레이어 지원 (향후)

### 기술 부채
- 공격 대상 추적 로직 개선 필요
- 턴 타이머 구현 필요
- 에러 코드 체계 구축 필요

---

**작성자**: 백엔드 개발자  
**최종 업데이트**: 2025-12-12

